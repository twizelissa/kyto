# マイナンバーカード申請システム - プロセスフロー管理表

## 全体プロセス構造

### メインフロー

| Page | Function | Task | Status | Memo |
|------|----------|------|---------|------|
| **トップページ** | システム初期化 | ウェルカム画面表示 | ✅ 完了 | 京都市ブランディング適用済み |
| | | 「質問を始める」ボタン | ✅ 完了 | 京都紫カラー適用 |
| | | 注意事項削除 | ✅ 完了 | 自治体警告メッセージ除去済み |
| **質問フロー** | 来庁者判定 | 本人・法定代理人・任意代理人選択 | ✅ 完了 | 3パターン分岐実装 |
| | | 進捗バー表示 | ✅ 完了 | 視覚的進捗管理 |
| | | 前へ・次へボタン | ✅ 完了 | 京都紫スタイリング適用 |
| **年齢判定** | 年齢分岐処理 | 15歳未満判定 | ✅ 完了 | 法定代理人必須判定 |
| | | 20歳未満判定 | ✅ 完了 | 親権者同意判定 |
| **本人確認書類** | 書類判定 | 顔写真付き書類有無 | ✅ 完了 | 2パターン分岐 |
| | | 書類種別判定 | ✅ 完了 | 運転免許証・パスポート等 |
| **結果表示** | チェックリスト生成 | 個別必要書類リスト | ✅ 完了 | 動的生成システム |
| | | 修正リンク表示 | ✅ 完了 | 回答修正機能 |
| **PDF出力** | 文書生成 | jsPDF変換 | ✅ 完了 | 印刷最適化済み |
| | | QRコード埋め込み | ✅ 完了 | 結果ページリンク |
| **共有機能** | SNS連携 | LINE共有 | ✅ 完了 | URLエンコード対応 |
| | | SMS共有 | ✅ 完了 | テキスト形式対応 |

---

## 分岐フロー詳細

### 来庁者タイプ別フロー

| Page | Function | Task | Status | Memo |
|------|----------|------|---------|------|
| **本人申請** | 本人確認 | 年齢判定（15歳以上） | ✅ 完了 | 単独申請可能 |
| | | 本人確認書類判定 | ✅ 完了 | 顔写真付き優先 |
| | | 必要書類決定 | ✅ 完了 | 5項目チェックリスト |
| **法定代理人** | 代理要件確認 | 15歳未満判定 | ✅ 完了 | 親権者・後見人 |
| | | 代理人身分確認 | ✅ 完了 | 続柄証明書類 |
| | | 本人書類確認 | ✅ 完了 | 本人分も必要 |
| **任意代理人** | 委任状確認 | 委任状有無判定 | ✅ 完了 | 必須書類判定 |
| | | 代理人本人確認 | ✅ 完了 | 代理人用書類 |
| | | 本人書類確認 | ✅ 完了 | 本人分確認 |

---

## 技術プロセス

### フロントエンド処理

| Page | Function | Task | Status | Memo |
|------|----------|------|---------|------|
| **コンポーネント** | React初期化 | App.tsx構成 | ✅ 完了 | Wouter routing使用 |
| | | QuestionWizard | ✅ 完了 | 質問フロー制御 |
| | | ResultsDisplay | ✅ 完了 | 結果表示・修正機能 |
| **スタイリング** | Tailwind設定 | 京都紫カスタムテーマ | ✅ 完了 | #663399メインカラー |
| | | レスポンシブ対応 | ✅ 完了 | モバイル・タブレット |
| | | shadcn/ui統合 | ✅ 完了 | カード・ボタン統一 |
| **状態管理** | React Hooks | 質問回答管理 | ✅ 完了 | useState/useEffect |
| | | TanStack Query | ✅ 完了 | データフェッチ準備 |

---

### バックエンド処理

| Page | Function | Task | Status | Memo |
|------|----------|------|---------|------|
| **サーバー** | Express設定 | server/index.ts | ✅ 完了 | TypeScript使用 |
| | | API routes | ✅ 完了 | RESTful設計 |
| | | Vite統合 | ✅ 完了 | 開発時ホットリロード |
| **データ管理** | In-memory Storage | Map構造実装 | ✅ 完了 | 開発環境用 |
| | | Drizzle ORM設定 | ✅ 完了 | PostgreSQL準備済み |
| | | Schema定義 | ✅ 完了 | shared/schema.ts |

---

## データフロー

### 質問回答処理

| Page | Function | Task | Status | Memo |
|------|----------|------|---------|------|
| **入力処理** | 回答収集 | オプション選択処理 | ✅ 完了 | 単一選択UI |
| | | 回答保存 | ✅ 完了 | ローカル状態管理 |
| | | 進捗計算 | ✅ 完了 | パーセンテージ表示 |
| **分岐処理** | 条件判定 | rules-engine.ts | ✅ 完了 | 複雑分岐ロジック |
| | | 次質問決定 | ✅ 完了 | showWhen条件 |
| | | スキップ処理 | ✅ 完了 | 不要質問除外 |
| **結果生成** | 書類判定 | getRequiredDocuments | ✅ 完了 | 個別要件計算 |
| | | リスト生成 | ✅ 完了 | チェックリスト形式 |

---

## UI/UX プロセス

### ユーザー体験フロー

| Page | Function | Task | Status | Memo |
|------|----------|------|---------|------|
| **導入** | 初回訪問 | ウェルカム画面 | ✅ 完了 | 分かりやすい説明 |
| | | 開始誘導 | ✅ 完了 | 明確なCTA |
| **質問段階** | 質問表示 | 読みやすいフォント | ✅ 完了 | 日本語最適化 |
| | | 選択肢提示 | ✅ 完了 | アイコン付きオプション |
| | | 進捗表示 | ✅ 完了 | プログレスバー |
| **ナビゲーション** | 前へボタン | 戻り機能 | ✅ 完了 | 回答修正可能 |
| | | 次へボタン | ✅ 完了 | 選択後活性化 |
| | | 完了ボタン | ✅ 完了 | 最終質問で表示 |
| **結果提示** | チェックリスト | 見やすい一覧 | ✅ 完了 | チェックボックス形式 |
| | | アクション | ✅ 完了 | PDF・共有ボタン |

---

## 出力・共有プロセス

### PDF生成フロー

| Page | Function | Task | Status | Memo |
|------|----------|------|---------|------|
| **PDF作成** | html2canvas | DOM要素キャプチャ | ✅ 完了 | 高解像度対応 |
| | | jsPDF統合 | ✅ 完了 | A4サイズ最適化 |
| | | QRコード追加 | ✅ 完了 | 結果ページリンク |
| **印刷最適化** | レイアウト調整 | print用CSS | ✅ 完了 | @media print |
| | | 改ページ制御 | ✅ 完了 | 適切な分割 |

### 共有機能フロー

| Page | Function | Task | Status | Memo |
|------|----------|------|---------|------|
| **LINE共有** | URL生成 | 結果ページリンク | ✅ 完了 | 状態保持URL |
| | | LINE API連携 | ✅ 完了 | 外部アプリ起動 |
| **SMS共有** | テキスト生成 | 要約メッセージ | ✅ 完了 | 文字数制限対応 |
| | | SMS起動 | ✅ 完了 | デバイス標準機能 |

---

## 品質保証プロセス

### テストフロー

| Page | Function | Task | Status | Memo |
|------|----------|------|---------|------|
| **手動テスト** | 全フロー確認 | 各分岐テスト | ✅ 完了 | 全パターン動作確認 |
| | | ブラウザ対応 | ✅ 完了 | Chrome/Safari/Firefox |
| | | レスポンシブ | ✅ 完了 | モバイル・PC確認 |
| **自動テスト** | Unit Test | 📋 To do | 未実装 | Jest + Testing Library |
| | | E2E Test | 📋 To do | 未実装 | Playwright検討 |

---

## デプロイプロセス

### リリースフロー

| Page | Function | Task | Status | Memo |
|------|----------|------|---------|------|
| **ビルド** | フロントエンド | Vite build | ✅ 完了 | 最適化設定済み |
| | | バックエンド | esbuild | ✅ 完了 | TypeScript変換 |
| **デプロイ** | Replit Deploy | ワンクリック | 📋 To do | 本番環境準備 |
| | | 環境変数設定 | 📋 To do | DATABASE_URL等 |

---

## 今後の拡張プロセス

### Phase 3 計画

| Page | Function | Task | Status | Memo |
|------|----------|------|---------|------|
| **データベース** | PostgreSQL | 接続設定 | 📋 To do | Neon Database使用予定 |
| | | マイグレーション | 📋 To do | Drizzle Kit使用 |
| **セッション管理** | ユーザー識別 | セッション保存 | 📋 To do | connect-pg-simple |
| | | 回答永続化 | 📋 To do | データベース保存 |
| **分析機能** | アクセス解析 | 利用統計 | 📋 To do | 管理画面必要 |
| | | A/Bテスト | 📋 To do | 最適化実験 |

---

## ステータス凡例

- ✅ **完了**: 実装・テスト完了済み
- 🚧 **進行中**: 現在開発作業中
- 📋 **To do**: 計画済み・未着手
- ⚠️ **課題あり**: 問題・遅延発生
- 🔄 **レビュー中**: コードレビュー・承認待ち

---

**最終更新**: 2024年8月9日  
**更新者**: Development Team  
**次回レビュー**: TBD